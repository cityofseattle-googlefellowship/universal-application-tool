#!/bin/bash
pushd $(git rev-parse --show-toplevel)

# find repo root name (currently civiform), also support any names for backward and forward compatibility
CIVIFORM_DIR=$(basename $(pwd))

create_s3_cmd="s3api create-bucket --bucket civiform-local-s3 --region us-west-2"

if ! which aws; then
    docker run --rm -it \
    --network ${CIVIFORM_DIR}_default \
    -e AWS_ACCESS_KEY_ID=test \
    -e AWS_SECRET_ACCESS_KEY=test \
    amazon/aws-cli \
        --endpoint-url=http://localstack:4566 \
        $create_s3_cmd

    exit $?
fi

aws --endpoint-url=http://localhost:4566 $create_s3_cmd

popd
