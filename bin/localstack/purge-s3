#!/bin/bash
pushd $(git rev-parse --show-toplevel)

# find repo root name (currently civiform), also support any names for backward and forward compatibility
CIVIFORM_DIR=${PWD##*/}

purge_s3_cmd="s3 rm s3://civiform-local-s3/ --recursive"

if ! which aws; then
    docker run --rm -it \
    --network ${CIVIFORM_DIR}_default \
    -e AWS_ACCESS_KEY_ID=test \
    -e AWS_SECRET_ACCESS_KEY=test \
    amazon/aws-cli \
        --endpoint-url=http://localstack:4566 \
        $purge_s3_cmd

    exit $?
fi

aws --endpoint-url=http://localhost:4566 $purge_s3_cmd

popd
